According to this (https://batteryuniversity.com/index.php/learn/article/charging_lithium_ion_batteries) and other articles, the maximum voltage to charge a LI cell is 4.2 Volts. Charging a LI to 4.2 volts will cause the battery to have a shorter life. The charger should instead charge a LI cell to a 4.1 V maximum. A battery pack where each cell in the pack is between 4.05 and 4.1 volt will be considered fully charged. Further, there is no downside to charging to 4.0 volts except that the cells will operate at 80% capaicty. Thus, fast charging to 80% will be the norm. The charge current should be 1C, however the maximum current rating for 21700 cells varies widely between different models. Some are capable of several amps, others can source and sink 10 amps, while the Samsung 40T is rated at 30 amps. The design will use a nominal current of 1.2 amps per cell, and according to liturature, should result in a fully charged cell in less than 2 hours. While there are designs using the LM317T variable voltage regultor, the design explored will instead use a power PNP or NPN transitor, providing a high output impedance. If a PNP transistor is chosen, then a constant current source can be provided from a voltage power supply. Because of Kircoffs Current Law (KCL), a BJT transistor can be wired in series with the LI cell. Current passes through the transistor and the cell, causing the cell to charge, while "taking" the cell voltage. A current source would be configured with a power PNP transistor connected between a charging voltage source, and the positive terminal of the LI cell, while the negative terminal of the cell is connected to the ground of the charging voltage source. A current sink would be configured with a NPN transistor wired between the LI cell and the ground of the powers upply, while the positive terminal of the LI cell is connected to the positive terminal of the power supply.

Each battery pack is managed by a pack controller board. This board is elecgtrically isolated from the battery back. It controls a set of relays that switch each battery beween two sets of rails, a primary rail, and a secondary rail. It continually reads the voltage of the primary rail, in addition to the secondary rail. Because one or more batteries can be switched to the secondary rail, isolated voltage readings from individual batteries can be invoked.

The pack controller board contains two busses. Each bus has a positive rail and a negative rail and each is capable of conducting 30 amps. There is am opto-isolated DTDP relay that switched the battery between the two busses. One bus (A) is a series connection between the neighboring layers, while the other bus is local, and can optionally connect to a service bus through yet another DTDP relay.
  
